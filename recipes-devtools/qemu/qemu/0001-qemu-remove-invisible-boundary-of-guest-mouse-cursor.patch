From 58ad71dbd5cb4eaf94938a36adb1f1c004eff25a Mon Sep 17 00:00:00 2001
From: Dongwon Kim <dongwon.kim@intel.com>
Date: Tue, 30 May 2023 09:46:43 -0700
Subject: [PATCH] qemu: remove invisible boundary of guest mouse cursor

make the VM mouse still move even after the cursor hits the boundary
of the host display

Signed-off-by: Dongwon Kim <dongwon.kim@intel.com>
---
 ui/gtk.c | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/ui/gtk.c b/ui/gtk.c
index fccb96eb21..12c8e223fe 100644
--- a/ui/gtk.c
+++ b/ui/gtk.c
@@ -1063,6 +1063,23 @@ static gboolean gd_motion_event(GtkWidget *widget, GdkEventMotion *motion,
     } else if (s->last_set && s->ptr_owner == vc) {
         int dx = x - s->last_x;
         int dy = y - s->last_y;
+        GdkRectangle curr_geometry;
+
+        monitor = gdk_display_get_monitor_at_point(dpy, motion->x_root, motion->y_root);
+
+        gdk_monitor_get_geometry(monitor, &curr_geometry);
+
+        if (motion->x_root <= curr_geometry.x) {
+            dx = -5;
+        } else if (motion->x_root >= curr_geometry.x + curr_geometry.width - 1) {
+            dx = 5;
+        }
+
+        if (motion->y_root <= curr_geometry.y) {
+            dy = -5;
+        } else if (motion->y_root >= curr_geometry.y + curr_geometry.height - 1) {
+            dy = 5;
+        }
 
         /*
          * To converge/sync the Guest's and Host's cursor locations more
-- 
2.34.1

