From 48dde03996024e9fa87fed1f576b07ceda329804 Mon Sep 17 00:00:00 2001
From: Chen Meng J <meng.j.chen@intel.com>
Date: Wed, 9 Oct 2019 15:03:11 +0800
Subject: [PATCH 31/33] media: intel-ipu: fix iommu_ops unmap params for kernel
 5.4

fix iommu_ops unmap params for kernel 5.4

Change-Id: I6cbe7846f70ce2b0a7d2ca65711ee0e65c46ed16
Signed-off-by: Chen Meng J <meng.j.chen@intel.com>
---
 drivers/media/pci/intel/ipu-mmu.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drivers/media/pci/intel/ipu-mmu.c b/drivers/media/pci/intel/ipu-mmu.c
index 2495b5667b17..37329c19cade 100644
--- a/drivers/media/pci/intel/ipu-mmu.c
+++ b/drivers/media/pci/intel/ipu-mmu.c
@@ -511,8 +511,14 @@ static size_t l2_unmap(struct iommu_domain *domain, unsigned long iova,
 	return unmapped << ISP_PAGE_SHIFT;
 }
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(5, 4, 0)
+static size_t ipu_mmu_unmap(struct iommu_domain *domain,
+			    unsigned long iova, size_t size,
+			    struct iommu_iotlb_gather *gather)
+#else
 static size_t ipu_mmu_unmap(struct iommu_domain *domain,
 			    unsigned long iova, size_t size)
+#endif
 {
 	return l2_unmap(domain, iova, 0, size);
 }
-- 
2.20.1

