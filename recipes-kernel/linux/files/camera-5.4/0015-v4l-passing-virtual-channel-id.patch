From 17d575c0fa6d505f4e5636dcb2ba901239b7f332 Mon Sep 17 00:00:00 2001
From: Chen Meng J <meng.j.chen@intel.com>
Date: Tue, 22 Oct 2019 13:04:25 +0800
Subject: [PATCH 15/33] v4l: passing virtual channel id

Change-Id: Ie5d42b9cef2cb43f8d5f4efbfdd8a14c9a2729c9
Signed-off-by: Chen Meng J <meng.j.chen@intel.com>
---
 drivers/media/common/videobuf2/videobuf2-v4l2.c | 6 +++++-
 include/media/videobuf2-v4l2.h                  | 1 +
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/drivers/media/common/videobuf2/videobuf2-v4l2.c b/drivers/media/common/videobuf2/videobuf2-v4l2.c
index 5a9ba3846f0a..039141322022 100644
--- a/drivers/media/common/videobuf2/videobuf2-v4l2.c
+++ b/drivers/media/common/videobuf2/videobuf2-v4l2.c
@@ -480,7 +480,11 @@ static void __fill_v4l2_buffer(struct vb2_buffer *vb, void *pb)
 	b->timecode = vbuf->timecode;
 	b->sequence = vbuf->sequence;
 	b->reserved2 = 0;
-	b->request_fd = 0;
+	/*
+	 * Use reserved to save vc_id, delete request_fd which is not used
+	 * currently, it's union for reserved and request_id.
+	 */
+	b->reserved = vbuf->reserved;
 
 	if (q->is_multiplanar) {
 		/*
diff --git a/include/media/videobuf2-v4l2.h b/include/media/videobuf2-v4l2.h
index 8a10889dc2fd..2c37d481bfb3 100644
--- a/include/media/videobuf2-v4l2.h
+++ b/include/media/videobuf2-v4l2.h
@@ -47,6 +47,7 @@ struct vb2_v4l2_buffer {
 	__u32			sequence;
 	__s32			request_fd;
 	struct vb2_plane	planes[VB2_MAX_PLANES];
+	__u32                   reserved;
 };
 
 /*
-- 
2.20.1

