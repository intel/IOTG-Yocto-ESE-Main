From 31bce69a3a8b961f10bd341f14b05b0108ce74bc Mon Sep 17 00:00:00 2001
From: dnagasun <devamekalai.nagasundaram@intel.com>
Date: Thu, 18 Apr 2019 08:08:31 +0800
Subject: [PATCH] lib: decoder: vp9: Set chroma_type by VP9 bit_depth

Signed-off-by: dnagasun <devamekalai.nagasundaram@intel.com>
---
 gst-libs/gst/vaapi/gstvaapidecoder_vp9.c | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/gst-libs/gst/vaapi/gstvaapidecoder_vp9.c b/gst-libs/gst/vaapi/gstvaapidecoder_vp9.c
index 2466b7b..f164c8c 100644
--- a/gst-libs/gst/vaapi/gstvaapidecoder_vp9.c
+++ b/gst-libs/gst/vaapi/gstvaapidecoder_vp9.c
@@ -220,7 +220,16 @@ ensure_context (GstVaapiDecoderVp9 * decoder)
 
     info.profile = priv->profile;
     info.entrypoint = entrypoint;
-    info.chroma_type = GST_VAAPI_CHROMA_TYPE_YUV420;
+    if (priv->parser->bit_depth == GST_VP9_BIT_DEPTH_8) {
+      info.chroma_type = GST_VAAPI_CHROMA_TYPE_YUV420;
+    } else if (priv->parser->bit_depth == GST_VP9_BIT_DEPTH_10) {
+      info.chroma_type = GST_VAAPI_CHROMA_TYPE_YUV420_10BPP;
+    } else {
+      GST_WARNING ("VP9 with depth %d, bigger than 10BPP not supported now",
+          priv->parser->bit_depth);
+      return GST_VAAPI_DECODER_STATUS_ERROR_UNSUPPORTED_CHROMA_FORMAT;
+    }
+
     info.width = priv->width;
     info.height = priv->height;
     info.ref_frames = 8;
-- 
2.7.4

