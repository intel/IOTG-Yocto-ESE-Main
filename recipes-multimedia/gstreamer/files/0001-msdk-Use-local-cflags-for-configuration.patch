From 7d825fb3c0cca45e2dda8b6c7c7930f1b87fca01 Mon Sep 17 00:00:00 2001
From: "Ung, Teng En" <teng.en.ung@intel.com>
Date: Wed, 4 Aug 2021 13:25:47 +0000
Subject: [PATCH 1/2] msdk: Use local cflags for configuration.

---
 sys/msdk/meson.build | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/sys/msdk/meson.build b/sys/msdk/meson.build
index 89351a733..642777316 100644
--- a/sys/msdk/meson.build
+++ b/sys/msdk/meson.build
@@ -34,6 +34,7 @@ have_msdk = false
 msdk_dep = []
 use_msdk = false
 use_onevpl = false
+msdk_extra_args = []
 
 msdk_option = get_option('msdk')
 if msdk_option.disabled()
@@ -106,9 +107,10 @@ elif cxx.has_header('mfx/mfxdefs.h', args: '-I' + mfx_incdir)
   mfx_inc = include_directories(mfx_incdir)
 endif
 
+
 if use_onevpl or cxx.has_header('mfxvp9.h', args: '-I' + mfx_incdir)
   msdk_sources += [ 'gstmsdkvp9dec.c' ]
-  cdata.set10('USE_MSDK_VP9_DEC', 1)
+  msdk_extra_args += ['-DUSE_MSDK_VP9_DEC=1']
 endif
 
 # Usually MFX_VERSION 1026+ is required to support raw VP9 stream, however Fedora 30 has MFX_VERSION==1026
@@ -128,7 +130,7 @@ have_mfx_ver126 = cc.compiles(mfx_ver126_check_code,
 
 if have_mfx_ver126
   msdk_sources += [ 'gstmsdkvp9enc.c' ]
-  cdata.set10('USE_MSDK_VP9_ENC', 1)
+  msdk_extra_args += ['-DUSE_MSDK_VP9_ENC=1']
 endif
 
 mfx_ver134_check_code = '''
@@ -143,7 +145,7 @@ have_mfx_ver134 = cc.compiles(mfx_ver134_check_code,
 
 if have_mfx_ver134
   msdk_sources += [ 'gstmsdkav1dec.c' ]
-  cdata.set10('USE_MSDK_AV1_DEC', 1)
+  msdk_extra_args += ['-DUSE_MSDK_AV1_DEC=1']
 endif
 
 if host_machine.system() == 'windows'
@@ -164,9 +166,10 @@ else
 endif
 
 if msdk_deps_found
+  msdk_extra_args += ['-DGST_USE_UNSTABLE_API']
   gstmsdktag = library('gstmsdk',
     msdk_sources,
-    c_args : gst_plugins_bad_args + ['-DGST_USE_UNSTABLE_API'],
+    c_args : gst_plugins_bad_args + msdk_extra_args,
     include_directories : [configinc, mfx_inc],
     dependencies : [gstbase_dep, gstvideo_dep, gstpbutils_dep, gstallocators_dep, gstcodecparsers_dep, mfx_dep, msdk_deps],
     install : true,
-- 
2.24.3

