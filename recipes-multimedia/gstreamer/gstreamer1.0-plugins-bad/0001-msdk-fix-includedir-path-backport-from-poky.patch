From ed062e67e9b5e3832154d4c24df3844fc0880aa3 Mon Sep 17 00:00:00 2001
From: Lim Siew Hoon <siew.hoon.lim@intel.com>
Date: Wed, 19 May 2021 19:05:49 +0800
Subject: [PATCH] msdk: fix includedir path backport from poky

This patch is backport from poky side and rework
to fix for VPL includedir as well.

Here is commit id from Poky:
commit c750a47a5e98e768e68b1f15f524b12173fba685
Author: Naveen Saini <naveen.kumar.saini@intel.com>
Date:   Wed Jan 13 11:07:22 2021 +0800

    gstreamer1.0-plugins-bad: fix msdk pkgconfig build failure

    Error log:
    | Run-time dependency libmfx found: YES 1.34
    | Has header "mfx/mfxdefs.h" : YES
    |
    | ../gst-plugins-bad-1.18.2/sys/msdk/meson.build:75:2: ERROR: Include dir /usr/include/mfx does not exist.
    |
    | A full log can be found at /home/s

    When msdk is enable in PACKAGECONFIG, plugin fails to locate includedir, so
    adding a patch which prepend PKG_CONFIG_SYSROOT_DIR to the dir path

    (From OE-Core rev: 204aa9cfa6ac99846ac494778dd143a13746ac7e)

    Signed-off-by: Naveen Saini <naveen.kumar.saini@intel.com>
    Signed-off-by: Richard Purdie <richard.purdie@linuxfoundation.org>

Signed-off-by: Lim Siew Hoon <siew.hoon.lim@intel.com>
---
 sys/msdk/meson.build | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/sys/msdk/meson.build b/sys/msdk/meson.build
index 9e95973f2..ead76b359 100644
--- a/sys/msdk/meson.build
+++ b/sys/msdk/meson.build
@@ -46,7 +46,9 @@ if mfx_api != 'oneVPL'
   mfx_dep = dependency('libmfx', version: ['>= 1.0', '<= 1.99'], required: false)
 
   if mfx_dep.found()
+    pkgconf_sysroot = run_command(python3, '-c', 'import os; print(os.environ.get("PKG_CONFIG_SYSROOT_DIR"))').stdout().strip()
     mfx_incdir = mfx_dep.get_pkgconfig_variable('includedir')
+    mfx_incdir = pkgconf_sysroot +  mfx_incdir
     mfx_inc = []
     use_msdk = true
   else
@@ -75,7 +77,9 @@ if not use_msdk and mfx_api != 'MSDK'
   mfx_dep = dependency('vpl', version: '>= 2.2', required: false)
 
   if mfx_dep.found()
+    pkgconf_sysroot = run_command(python3, '-c', 'import os; print(os.environ.get("PKG_CONFIG_SYSROOT_DIR"))').stdout().strip()
     mfx_incdir = mfx_dep.get_pkgconfig_variable('includedir')
+    mfx_incdir = pkgconf_sysroot +  mfx_incdir
     mfx_inc = []
     use_onevpl = true
   endif
-- 
2.31.1

