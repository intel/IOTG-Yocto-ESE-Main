From 568d833f9367571f96dc64cc8e32cd2231534e35 Mon Sep 17 00:00:00 2001
From: Haihao Xiang <haihao.xiang@intel.com>
Date: Fri, 2 Jul 2021 16:22:04 +0800
Subject: [PATCH 4/4] glimagesink: fix Y412_LE in memory:DMABuf

---
 gst-libs/gst/gl/egl/gsteglimage.c | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/gst-libs/gst/gl/egl/gsteglimage.c b/gst-libs/gst/gl/egl/gsteglimage.c
index 93fdc5eb6..0be5053cc 100644
--- a/gst-libs/gst/gl/egl/gsteglimage.c
+++ b/gst-libs/gst/gl/egl/gsteglimage.c
@@ -111,6 +111,14 @@
 #define DRM_FORMAT_Y410           fourcc_code('Y', '4', '1', '0')
 #endif
 
+#ifndef DRM_FORMAT_ABGR16161616
+#define DRM_FORMAT_ABGR16161616   fourcc_code('A', 'B', '4', '8')
+#endif
+
+#ifndef DRM_FORMAT_Y412
+#define DRM_FORMAT_Y412         fourcc_code('Y', '4', '1', '2')
+#endif
+
 #ifndef EGL_LINUX_DMA_BUF_EXT
 #define EGL_LINUX_DMA_BUF_EXT 0x3270
 #endif
@@ -589,6 +597,12 @@ _drm_rgba_fourcc_from_info (const GstVideoInfo * info, int plane,
       *out_format = GST_GL_RGB10_A2;
       return rgb10a2_fourcc;
 
+      /* Don't support Y412_BE because RGBA16161616
+         isn't defined in mesa, */
+    case GST_VIDEO_FORMAT_Y412_LE:
+      *out_format = GST_GL_RGBA16;
+      return DRM_FORMAT_ABGR16161616;
+
     default:
       GST_ERROR ("Unsupported format for DMABuf.");
       return -1;
@@ -765,6 +779,9 @@ _drm_direct_fourcc_from_info (const GstVideoInfo * info)
     case GST_VIDEO_FORMAT_Y410:
       return DRM_FORMAT_Y410;
 
+    case GST_VIDEO_FORMAT_Y412_LE:
+      return DRM_FORMAT_Y412;
+
     default:
       GST_INFO ("Unsupported format for direct DMABuf.");
       return -1;
-- 
2.24.3

