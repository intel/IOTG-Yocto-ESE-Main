From e9e80397b3825a377325c9154cfbe00f6f5a0b00 Mon Sep 17 00:00:00 2001
From: "Szymichowski, Pawel" <pawel.szymichowski@intel.com>
Date: Thu, 30 Jun 2022 09:24:42 +0000
Subject: [PATCH 2/2]  Added some Alderlake related functionality

.
---
 IGC/Compiler/CISACodeGen/CISABuilder.cpp | 1 +
 IGC/Compiler/CISACodeGen/Platform.hpp    | 3 +++
 IGC/common/ShaderOverride.cpp            | 1 +
 IGC/common/SystemThread.cpp              | 3 +++
 4 files changed, 8 insertions(+)

diff --git a/IGC/Compiler/CISACodeGen/CISABuilder.cpp b/IGC/Compiler/CISACodeGen/CISABuilder.cpp
index 990945e5cd7c..bd4f1fb5633c 100644
--- a/IGC/Compiler/CISACodeGen/CISABuilder.cpp
+++ b/IGC/Compiler/CISACodeGen/CISABuilder.cpp
@@ -3177,6 +3177,7 @@ namespace IGC
                 || platform->getPlatformInfo().eProductFamily == IGFX_ROCKETLAKE
                 || platform->getPlatformInfo().eProductFamily == IGFX_ALDERLAKE_S
                 || platform->getPlatformInfo().eProductFamily == IGFX_ALDERLAKE_P
+                || platform->getPlatformInfo().eProductFamily == IGFX_ALDERLAKE_N
                )
             {
                 return GENX_TGLLP;
diff --git a/IGC/Compiler/CISACodeGen/Platform.hpp b/IGC/Compiler/CISACodeGen/Platform.hpp
index fdc487f24de3..6b970f55621f 100644
--- a/IGC/Compiler/CISACodeGen/Platform.hpp
+++ b/IGC/Compiler/CISACodeGen/Platform.hpp
@@ -1086,6 +1086,7 @@ bool hasNoInt64Inst() const {
         m_platformInfo.eProductFamily == IGFX_ROCKETLAKE ||
         m_platformInfo.eProductFamily == IGFX_ALDERLAKE_S ||
         m_platformInfo.eProductFamily == IGFX_ALDERLAKE_P ||
+        m_platformInfo.eProductFamily == IGFX_ALDERLAKE_N ||
         m_platformInfo.eProductFamily == IGFX_DG1 ||
         m_platformInfo.eProductFamily == IGFX_DG2;
 }
@@ -1100,6 +1101,7 @@ bool hasNoFP64Inst() const {
         m_platformInfo.eProductFamily == IGFX_ROCKETLAKE ||
         m_platformInfo.eProductFamily == IGFX_ALDERLAKE_S ||
         m_platformInfo.eProductFamily == IGFX_ALDERLAKE_P ||
+        m_platformInfo.eProductFamily == IGFX_ALDERLAKE_N ||
         m_platformInfo.eProductFamily == IGFX_DG1 ||
         m_platformInfo.eProductFamily == IGFX_DG2;
 }
@@ -1114,6 +1116,7 @@ bool hasCorrectlyRoundedMacros() const {
         m_platformInfo.eProductFamily != IGFX_DG1 &&
         m_platformInfo.eProductFamily != IGFX_ALDERLAKE_S &&
         m_platformInfo.eProductFamily != IGFX_ALDERLAKE_P &&
+        m_platformInfo.eProductFamily != IGFX_ALDERLAKE_N &&
         m_platformInfo.eProductFamily != IGFX_DG2;
 }
 
diff --git a/IGC/common/ShaderOverride.cpp b/IGC/common/ShaderOverride.cpp
index a9bab9777ec1..1580ce9fd0e0 100644
--- a/IGC/common/ShaderOverride.cpp
+++ b/IGC/common/ShaderOverride.cpp
@@ -130,6 +130,7 @@ iga_gen_t GetIGAPlatform(PLATFORM const & platform)
             || ProductFamily == IGFX_ROCKETLAKE
             || ProductFamily == IGFX_ALDERLAKE_S
             || ProductFamily == IGFX_ALDERLAKE_P
+            || ProductFamily == IGFX_ALDERLAKE_N
            )
         {
             return IGA_GEN12p1;
diff --git a/IGC/common/SystemThread.cpp b/IGC/common/SystemThread.cpp
index e309accab7f5..b3b886795664 100644
--- a/IGC/common/SystemThread.cpp
+++ b/IGC/common/SystemThread.cpp
@@ -742,6 +742,8 @@ CGenSystemInstructionKernelProgram* CGenSystemInstructionKernelProgram::Create(
             case IGFX_DG1:
             case IGFX_ROCKETLAKE:
             case IGFX_ALDERLAKE_S:
+            case IGFX_ALDERLAKE_P:
+            case IGFX_ALDERLAKE_N:
                 SIPIndex = bindlessMode ? GEN12_LP_CSR_DEBUG_BINDLESS : GEN12_LP_CSR_DEBUG;
                 break;
             case IGFX_XE_HP_SDV:
@@ -771,6 +773,7 @@ CGenSystemInstructionKernelProgram* CGenSystemInstructionKernelProgram::Create(
             case IGFX_ROCKETLAKE:
             case IGFX_ALDERLAKE_S:
             case IGFX_ALDERLAKE_P:
+            case IGFX_ALDERLAKE_N:
                 SIPIndex = GEN12_LP_CSR;
                 break;
             case IGFX_XE_HP_SDV:
-- 
2.34.1

